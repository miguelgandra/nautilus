% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/calculateTailBeats.R
\name{calculateTailBeats}
\alias{calculateTailBeats}
\title{Calculate Tail Beat Frequencies}
\usage{
calculateTailBeats(
  data,
  id.col = "ID",
  datetime.col = "datetime",
  motion.col = "sway",
  min.freq.Hz = 0.05,
  max.freq.Hz = 3,
  smooth.window = 10,
  max.rows.per.batch = 2e+05,
  ridge.only = FALSE,
  power.ratio.threshold = NULL,
  max.interp.gap = 10,
  cores = 1,
  plot = TRUE,
  output.dir = NULL,
  png.width = 24,
  png.height = 6,
  png.res = 600
)
}
\arguments{
\item{data}{A data frame or a list of data frames containing depth profile information.}

\item{id.col}{Character. The name of the column identifying individuals (default: "ID").}

\item{datetime.col}{Character. The name of the column containing datetime information (default: "datetime").}

\item{motion.col}{Character. The name of the column containing motion data (e.g., "sway") to analyze.}

\item{min.freq.Hz}{Numeric. The lowest frequency of interest (in Hz). Default is 0.05 Hz.}

\item{max.freq.Hz}{Numeric. The highest frequency of interest (in Hz). Default is 3 Hz.}

\item{smooth.window}{Numeric. Window size (in seconds) for moving average smoothing of frequency estimates.
Set to 0 to disable smoothing. Default is 10 seconds.}

\item{max.rows.per.batch}{Numeric. Maximum number of rows to process in each batch when handling large datasets.
The function automatically determines optimal batch sizes based on frequency resolution requirements,
but this parameter sets an upper limit to prevent memory issues. Default is 200,000 rows.
Lower values reduce memory usage but may increase processing time for very large datasets.}

\item{ridge.only}{Logical. If TRUE, only returns frequencies identified as ridges (connected local maxima)
in the wavelet power spectrum. If FALSE (default), uses all local maxima in the power spectrum.}

\item{power.ratio.threshold}{Numeric or NULL. Minimum ratio between peak power and average power
for a frequency to be considered valid. NULL disables this filter. Default is NULL.}

\item{max.interp.gap}{Numeric. Maximum gap (in seconds) for linear interpolation of missing frequency values.
Set to NULL to disable interpolation. Default is 10 seconds.}

\item{cores}{Number of CPU cores for parallel processing (default = 1)}

\item{plot}{Logical. Whether to generate plots. Default is TRUE.}

\item{output.dir}{Character. If provided, all plots will be saved as PNG files in this directory instead of being displayed interactively.
Default is NULL (plots shown in R graphics device).}

\item{png.width}{Numeric. Width of PNG output in inches (default = 10).}

\item{png.height}{Numeric. Height of PNG output in inches (default = 7).}

\item{png.res}{Numeric. Resolution of PNG output in ppi (default = 300).}
}
\value{
Returns the input data with added column \code{tbf_hz} containing estimated tail beat
frequencies in Hz. For list inputs, returns a list of modified data frames.
}
\description{
This function uses continuous wavelet transform (CWT) to estimate tail beat frequencies
from motion sensor data. It can process data from multiple individuals
in parallel and provides visualization of the power spectrum with identified tail beats.
It features intelligent batch processing with automatic buffer zones to handle large
datasets efficiently while maintaining accuracy at batch boundaries.
}
\details{
The function implements a comprehensive workflow for tail beat frequency estimation:

\strong{Frequency Detection Methods:}
\itemize{
\item \code{ridge.only = TRUE}: Conservative approach using only connected maxima (ridges)
in the wavelet power spectrum. Most robust against noise but may miss weaker signals.

\item \code{ridge.only = FALSE}: More inclusive approach using all local maxima, with optional
quality filtering via \code{power.ratio.threshold}.
}

\strong{Quality Control:}
\itemize{
\item \code{power.ratio.threshold}: Filters frequencies where peak-to-average power ratio
is below threshold (recommended: 1.5-3 for typical data)

\item \code{smooth.window}: Applies temporal smoothing to reduce high-frequency variability
in estimates while preserving true behavioral patterns
}

\strong{Gap Handling:}
\itemize{
\item \code{max.interp.gap}: Intelligently fills short data gaps (< specified seconds) via
linear interpolation while preserving longer gaps as NA values. This maintains signal
continuity during brief measurement drops without over-interpolating prolonged gaps.
}

\strong{Intelligent Batch Processing:}
\itemize{
\item Automatically processes large datasets in memory-efficient batches when sampling frequency >1 Hz
\item Implements frequency-adaptive buffer zones (based on min.freq.Hz) to prevent edge artifacts
\item Seamlessly stitches results while maintaining temporal accuracy
}
}
\note{
The function requires the 'WaveletComp' package for the wavelet transform. For parallel processing,
it requires the 'foreach', 'doSNOW', and 'parallel' packages.

\strong{Sampling Frequency Requirements:}
The input data must have a sampling frequency (1/timestep) that satisfies the Nyquist criterion:
\itemize{
\item Minimum requirement: Sampling frequency > 2 x \code{max.freq.Hz}
\item Recommended: Sampling frequency ≥ 4 x \code{max.freq.Hz} for reliable results
\item Example: With \code{max.freq.Hz = 3}, data should be sampled at ≥ 12 Hz (minimum 6 Hz)
}#'
}
